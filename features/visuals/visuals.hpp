#pragma once
#include "../../sdk/sdk.hpp"
#include "../../hooks/hooks.hpp"

inline constexpr const static char collide_data[] = {
	char(0xB8), char(0x01), char(0x00), char(0x00), char(0x56), char(0x50), char(0x48), char(0x59), char(0x00), char(0x01),
	char(0x00), char(0x00), char(0x9C), char(0x01), char(0x00), char(0x00), char(0x00), char(0x00), char(0x80), char(0x3F),
	char(0x00), char(0x00), char(0x80), char(0x3F), char(0x00), char(0x00), char(0x80), char(0x3F), char(0x00), char(0x00),
	char(0x00), char(0x00), char(0x20), char(0x16), char(0x6A), char(0xC1), char(0xC0), char(0x0E), char(0x1C), char(0xC1),
	char(0x80), char(0x13), char(0xD0), char(0x3F), char(0xE2), char(0x26), char(0x11), char(0x48), char(0xE2), char(0x26),
	char(0x11), char(0x48), char(0xE2), char(0x26), char(0x11), char(0x48), char(0x72), char(0x4E), char(0x08), char(0xF44),
	char(0xD1), char(0x9C), char(0x01), char(0x00), char(0x80), char(0x01), char(0x00), char(0x00), char(0x00), char(0x00),
	char(0x00), char(0x00), char(0x00), char(0x00), char(0x00), char(0x00), char(0x49), char(0x56), char(0x50), char(0x53),
	char(0xD0), char(0x00), char(0x00), char(0x00), char(0x06), char(0x00), char(0x00), char(0x00), char(0x04), char(0x15),
	char(0x00), char(0x00), char(0x0C), char(0x00), char(0x00), char(0x00), char(0x00), char(0x90), char(0x00), char(0x00),
	char(0x00), char(0x00), char(0x0A), char(0x00), char(0x01), char(0x00), char(0x03), char(0x00), char(0x02), char(0x00),
	char(0x12), char(0x00), char(0x01), char(0x80), char(0x00), char(0x00), char(0x02), char(0x00), char(0xFD), char(0x7F),
	char(0x01), char(0x00), char(0x15), char(0x00), char(0x03), char(0x00), char(0x28), char(0x00), char(0x02), char(0xB0),
	char(0x00), char(0x00), char(0x00), char(0x00), char(0x06), char(0x00), char(0x04), char(0x00), char(0x0F), char(0x00),
	char(0x01), char(0x00), char(0xF6), char(0x7F), char(0x03), char(0xA0), char(0x00), char(0x00), char(0x00), char(0x00),
	char(0x06), char(0x00), char(0x05), char(0x00), char(0x15), char(0x00), char(0x04), char(0x00), char(0xFA), char(0x7F),
	char(0x04), char(0x70), char(0x00), char(0x00), char(0x00), char(0x00), char(0x06), char(0x00), char(0x06), char(0x00),
	char(0x13), char(0x00), char(0x05), char(0x00), char(0xFA), char(0x7F), char(0x05), char(0x60), char(0x00), char(0x00),
	char(0x00), char(0x00), char(0xEE), char(0x7F), char(0x02), char(0x00), char(0x18), char(0x00), char(0x06), char(0x00),
	char(0xFA), char(0x7F), char(0x06), char(0x50), char(0x00), char(0x00), char(0x01), char(0x00), char(0xF1), char(0x7F),
	char(0x04), char(0x00), char(0x03), char(0x00), char(0x03), char(0x00), char(0xEB), char(0x7F), char(0x07), char(0x40),
	char(0x00), char(0x00), char(0x03), char(0x00), char(0xFD), char(0x7F), char(0x04), char(0x00), char(0x04), char(0x00),
	char(0x07), char(0x00), char(0x0C), char(0x00), char(0x08), char(0x10), char(0x00), char(0x00), char(0x05), char(0x00),
	char(0x06), char(0x00), char(0x07), char(0x00), char(0xFC), char(0x7F), char(0x04), char(0x00), char(0xEB), char(0x7F),
	char(0x09), char(0x00), char(0x00), char(0x00), char(0x05), char(0x00), char(0xED), char(0x7F), char(0x06), char(0x00),
	char(0x03), char(0x00), char(0x07), char(0x00), char(0xFA), char(0x7F), char(0x0A), char(0x30), char(0x00), char(0x00),
	char(0x07), char(0x00), char(0xFD), char(0x7F), char(0x06), char(0x00), char(0x03), char(0x00), char(0x03), char(0x00),
	char(0xF4), char(0x7F), char(0x0B), char(0x20), char(0x00), char(0x00), char(0x03), char(0x00), char(0xFD), char(0x7F),
	char(0x06), char(0x00), char(0xE8), char(0x7F), char(0x02), char(0x00), char(0xD8), char(0x7F), char(0x46), char(0xAD),
	char(0x9D), char(0xC3), char(0x1F), char(0x0D), char(0x9C), char(0xC3), char(0x80), char(0xAE), char(0xAA), char(0x43),
	char(0x00), char(0x00), char(0x00), char(0x00), char(0x46), char(0xAD), char(0x9D), char(0xC3), char(0x33), char(0x4C),
	char(0x92), char(0x43), char(0x80), char(0xAE), char(0xAA), char(0x43), char(0x00), char(0x00), char(0x00), char(0x00),
	char(0x46), char(0xAD), char(0x9D), char(0xC3), char(0x1F), char(0x0D), char(0x9C), char(0xC3), char(0x59), char(0x0E),
	char(0xA9), char(0xC3), char(0x00), char(0x00), char(0x00), char(0x00), char(0x46), char(0xAD), char(0x9D), char(0xC3),
	char(0x33), char(0x4C), char(0x92), char(0x43), char(0x59), char(0x0E), char(0xA9), char(0xC3), char(0x00), char(0x00),
	char(0x00), char(0x00), char(0xE4), char(0x0B), char(0x8F), char(0x43), char(0x33), char(0x4C), char(0x92), char(0x43),
	char(0x80), char(0xAE), char(0xAA), char(0x43), char(0x00), char(0x00), char(0x00), char(0x00), char(0xE4), char(0x0B),
	char(0x8F), char(0x43), char(0x1F), char(0x0D), char(0x9C), char(0xC3), char(0x80), char(0xAE), char(0xAA), char(0x43),
	char(0x00), char(0x00), char(0x00), char(0x00), char(0xE4), char(0x0B), char(0x8F), char(0x43), char(0x1F), char(0x0D),
	char(0x9C), char(0xC3), char(0x59), char(0x0E), char(0xA9), char(0xC3), char(0x00), char(0x00), char(0x00), char(0x00),
	char(0xE4), char(0x0B), char(0x8F), char(0x43), char(0x33), char(0x4C), char(0x92), char(0x43), char(0x59), char(0x0E),
	char(0xA9), char(0xC3), char(0x00), char(0x00), char(0x00), char(0x00), char(0x00), char(0x00), char(0x00), char(0x00),
	char(0xB0), char(0xFE), char(0xFF), char(0xFF), char(0x20), char(0x16), char(0x6A), char(0xC1), char(0xC0), char(0x0E),
	char(0x1C), char(0xC1), char(0x80), char(0x13), char(0xD0), char(0x3F), char(0x72), char(0x4E), char(0x08), char(0x44),
	char(0x8A), char(0x8B), char(0x9C), char(0x00), char(0x73), char(0x6F), char(0x6C), char(0x69), char(0x64), char(0x20),
	char(0x7B), char(0x0A), char(0x22), char(0x69), char(0x6E), char(0x64), char(0x65), char(0x78), char(0x22), char(0x20),
	char(0x22), char(0x30), char(0x22), char(0x0A), char(0x22), char(0x6D), char(0x61), char(0x73), char(0x73), char(0x22),
	char(0x20), char(0x22), char(0x35), char(0x30), char(0x30), char(0x30), char(0x30), char(0x2E), char(0x30), char(0x30),
	char(0x30), char(0x30), char(0x30), char(0x30), char(0x22), char(0x0A), char(0x22), char(0x73), char(0x75), char(0x72),
	char(0x66), char(0x61), char(0x63), char(0x65), char(0x70), char(0x72), char(0x6F), char(0x70), char(0x22), char(0x20),
	char(0x22), char(0x64), char(0x65), char(0x66), char(0x61), char(0x75), char(0x6C), char(0x74), char(0x22), char(0x0A),
	char(0x22), char(0x76), char(0x6F), char(0x6C), char(0x75), char(0x6D), char(0x65), char(0x22), char(0x20), char(0x22),
	char(0x31), char(0x35), char(0x30), char(0x38), char(0x30), char(0x32), char(0x33), char(0x32), char(0x30), char(0x35),
	char(0x38), char(0x38), char(0x38), char(0x30), char(0x2E), char(0x30), char(0x30), char(0x30), char(0x30), char(0x30),
	char(0x30), char(0x22), char(0x0A), char(0x7D), char(0x0A), char(0x00)
};

namespace features::chams {
	void run(i_mat_render_context* ctx, const draw_model_state_t& state, const model_render_info_t& info, matrix_t* matrix);
	void run_bt(i_mat_render_context* ctx, const draw_model_state_t& state, const model_render_info_t& info, matrix_t* matrix);
	void run_other(i_mat_render_context* ctx, const draw_model_state_t& state, const model_render_info_t& info, matrix_t* matrix);
	void initialize();
}

struct bbox_t {
	int x, y, w, h;
	bbox_t() = default;
	bbox_t(const int x, const int y, const int w, const int h) {
		this->x = x;
		this->y = y;
		this->w = w;
		this->h = h;
	}
};

struct IDirect3DTexture9;
inline std::string oldtitle;
inline std::string oldartist;
inline IDirect3DTexture9* albumArtTexture = nullptr;
inline std::string strartist;
inline std::string strtitle;

namespace features::visuals {
	inline bool console_vis = false;
	inline int tick;
	inline int igonre_ticks = 0;
	inline int velocity_old = 0;
	inline vec3_t origin_old(0, 0, 0);

	inline std::wstring artist, title;
	inline bool pause = false;
	inline bool next = false;
	inline bool pervious = false;
	inline std::string albumArtPath;
	inline int64_t trackPosition;
	inline int64_t trackDuration = 0;
	inline std::string m_custom_sky_box{ };

	bool get_playerbox(player_t* entity, bbox_t& in);
	namespace player {
		void run();
		void animate(player_t* entity, const int index);
		void flags(player_t* entity, bbox_t bbox);
		void backtrack_dot(player_t* entity);
		void backtrack_skeleton(player_t* entity);
		void skeleton(player_t* entity);
		void draw_name(player_t* entity, bbox_t bbox);
		void draw_health(player_t* entity, bbox_t bbox);
		void draw_armor(player_t* entity, bbox_t bbox);
		void draw_weapon(player_t* entity, bbox_t bbox);
		void draw_box(player_t* entity, bbox_t bbox);

	}

	namespace glow {
		void run();
	}

	void watermark();
	void RenderMediaPlayer();
	void display_spotify();
	void jump_trail();
	void removals();
	void oof_arrows(player_t* player);
	void motion_blur(view_setup_t* setup);
	void dropped_weapons(player_t* entity);
	void bomb_esp(entity_t* entity);
	void apply_zoom();
	void fog();
	void shadows();
	void gravity_ragdoll();
	void skybox_changer();
	void fullbright();
	void flashalpha();
	void nosmoke();
	void dlights(player_t* entity);
	void run_freecam(c_usercmd* cmd, vec3_t angles);
	void freecam(view_setup_t* setup);
	void key_strokes();
	void console();

	struct motion_blur_history {
		motion_blur_history() {
			last_time_update = 0.0f;
			previous_pitch = 0.0f;
			previous_yaw = 0.0f;
			previous_pos = vec3_t{ 0.0f, 0.0f, 0.0f };
			no_rotational_mb_until = 0.0f;
		}

		float last_time_update;
		float previous_pitch;
		float previous_yaw;
		vec3_t previous_pos;
		float no_rotational_mb_until;
	};
	inline motion_blur_history history;

}

namespace features::weather {
	static bool last_state = false;
	static bool last_state_type = false;
	static bool created_rain = false;

	static precipitation_t* rain_entity = nullptr;
	static c_client_class* precipitation = nullptr;

	void reset_weather(const bool cleanup = true);
	void update_weather();
	void* getv_collideble();
}

namespace features::grenade_prediction {

	class c_nadepoint {
	public:
		c_nadepoint() {
			m_valid = false;
		}

		c_nadepoint(vec3_t start, vec3_t end, bool plane, bool valid, vec3_t normal, bool detonate) {
			m_start = start;
			m_end = end;
			m_plane = plane;
			m_valid = valid;
			m_normal = normal;
			m_detonate = detonate;
		}

		vec3_t m_start, m_end, m_normal;
		bool m_valid, m_plane, m_detonate;
	};

	inline std::array< c_nadepoint, 500 > _points{ };
	inline bool _predicted = false;
	void predict(c_usercmd* ucmd);
	bool detonated(weapon_t* weapon, float time, trace_t& trace);
	void run(c_usercmd* ucmd);
	void draw();
}
